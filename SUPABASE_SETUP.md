# Настройка Supabase для хранения файлов в приложении Monkey Messenger

## 1. Создание аккаунта и проекта в Supabase

1. Зарегистрируйтесь или войдите на сайте [Supabase](https://supabase.com/)
2. Создайте новый проект:
   - Нажмите на кнопку "New Project"
   - Введите имя проекта, например "monkey-messenger"
   - Создайте надежный пароль для базы данных (запишите его)
   - Выберите ближайший к вам регион
   - Нажмите "Create new project"

## 2. Получение API-ключей

После создания проекта вам понадобятся URL и Anon Key:

1. В панели управления проектом Supabase перейдите в раздел "Settings" -> "API"
2. Скопируйте значения:
   - **URL**: `https://[ваш-проект-id].supabase.co`
   - **anon public**: `ваш-публичный-ключ`
3. Вставьте эти значения в файл `lib/utils/supabase_config.dart`:

```dart
class SupabaseConfig {
  static const String supabaseUrl = 'https://[ваш-проект-id].supabase.co';
  static const String supabaseAnonKey = 'ваш-публичный-ключ';
  
  // Остальные настройки
}
```

## 3. Настройка Storage Buckets (хранилища)

Необходимо создать три хранилища для разных типов файлов:

1. В панели управления проектом перейдите в раздел "Storage"
2. Создайте три бакета (хранилища):
   - **chat_files**: для всех типов файлов
   - **chat_images**: для изображений
   - **chat_voice**: для голосовых сообщений

Для каждого бакета выполните следующие действия:
1. Нажмите "Create bucket"
2. Введите имя бакета (например "chat_files")
3. Установите уровень доступа "Public"
4. Нажмите "Create bucket"

## 4. Настройка политик доступа к файлам

Для каждого бакета необходимо настроить политики доступа (RLS - Row Level Security):

1. Перейдите в раздел "Storage" -> выберите созданный бакет -> "Policies"
2. Создайте следующие политики для каждого бакета:

### Для чтения файлов:
- Название: "Публичный доступ на чтение"
- Разрешение: SELECT
- Использовать шаблон: "For select operations (read)"
- Использовать выражение: `true` (для публичного доступа к чтению)

### Для загрузки файлов:
- Название: "Доступ на загрузку для аутентифицированных пользователей"
- Разрешение: INSERT
- Использовать шаблон: "For insert operations (create/upload)"
- Использовать выражение: `auth.role() = 'authenticated'` (только для аутентифицированных пользователей)

### Для удаления файлов:
- Название: "Доступ на удаление для аутентифицированных пользователей"
- Разрешение: DELETE
- Использовать шаблон: "For delete operations"
- Использовать выражение: `auth.role() = 'authenticated'` (только для аутентифицированных пользователей)

## 5. Настройка авторизации через Firebase

Если вы хотите продолжать использовать Firebase для авторизации, но хранить файлы в Supabase, особых дополнительных настроек не требуется. Supabase с нашими публичными политиками доступа позволит загружать файлы без авторизации, а управление доступом будет происходить через логику приложения.

## 6. Тестирование хранилища

Чтобы проверить, что хранилище работает правильно:

1. Запустите приложение
2. Отправьте файл или изображение в чат
3. Проверьте, что файл появился в соответствующем бакете в Supabase
4. Убедитесь, что ссылка на файл работает и отображается в приложении

## Дополнительная информация

- [Документация Supabase Storage](https://supabase.com/docs/guides/storage)
- [Flutter SDK для Supabase](https://supabase.com/docs/reference/dart/installing)
- [Row Level Security в Supabase](https://supabase.com/docs/guides/auth/row-level-security) 